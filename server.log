2025-03-03 23:32:46,137 - __main__ - INFO - Script starting...
2025-03-03 23:32:46,138 - __main__ - INFO - Environment loaded
2025-03-03 23:32:46,148 - __main__ - INFO - Main block starting
2025-03-03 23:32:46,148 - __main__ - INFO - Test data loaded
2025-03-03 23:32:46,148 - __main__ - INFO - Parsed main_data with phone number: +447436962389
2025-03-03 23:32:46,148 - __main__ - INFO - Starting test execution
2025-03-03 23:33:08,926 - __main__ - DEBUG - Subprocess output: 2025-03-03 23:32:46,137 - __main__ - INFO - Script starting...
2025-03-03 23:32:46,138 - __main__ - INFO - Environment loaded
Starting subprocess...
2025-03-03 23:32:46,148 - __main__ - INFO - Main block starting
2025-03-03 23:32:46,148 - __main__ - INFO - Test data loaded
2025-03-03 23:32:46,148 - __main__ - INFO - Parsed main_data with phone number: +447436962389
2025-03-03 23:32:46,148 - __main__ - INFO - Starting test execution
2025-03-03 23:32:46,998 - __main__ - INFO - {'id': 'd9218669-4f7c-428c-9ff3-18ecabfd91c6', 'orgId': 'd3da3821-d7a1-434e-abfe-37d4886fef2a', 'name': 'Inbound tester', 'voice': {'voiceId': 'asteria', 'provider': 'deepgram'}, 'createdAt': '2025-03-03T13:31:26.729Z', 'updatedAt': '2025-03-03T23:32:46.833Z', 'model': {'model': 'gpt-4o-mini', 'messages': [{'role': 'system', 'content': "\n  Your Name is question_permission. Pretend that you are Danielle, a cautious caller from Sydney who’s interested in Dar Global’s properties. You carefully monitor when people ask for your permission to proceed with questions, and you only offer a 'yes' when you’re ready to share more details..\n\n  Your task is to simulate this scenario immediately as soon as the conversation starts.\n  Scenario Name: Inquiry about 2-bedroom option in Qatar\n  Scenario Description: You call to learn if there’s a suitable 2-bedroom option in Qatar. At the beginning of the call, wait for the rep to say 'Can I ask you a few questions…?' and do not respond affirmatively at first. Then, see if the rep pauses or tries to proceed without your 'yes.' Eventually, say 'yes' to allow them to ask further questions. You also ask about the best time to speak with a relationship manager. End by agreeing to a meeting, confirming your time zone, and scheduling a specific date and time.\n  "}], 'provider': 'openai'}, 'firstMessage': 'Hello', 'transcriber': {'model': 'nova-3', 'language': 'en', 'provider': 'deepgram'}, 'clientMessages': ['transcript', 'conversation-update'], 'serverMessages': ['status-update', 'end-of-call-report'], 'hipaaEnabled': False, 'backchannelingEnabled': False, 'firstMessageMode': 'assistant-speaks-first', 'analysisPlan': {'successEvaluationPlan': {'enabled': False}}, 'backgroundDenoisingEnabled': False, 'server': {'url': 'https://728f-194-80-232-36.ngrok-free.app/vapi-webhook'}, 'compliancePlan': {'hipaaEnabled': False, 'pciEnabled': False}, 'isServerUrlSecretSet': False}
INFO:     Started server process [30835]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:8765 (Press CTRL+C to quit)
2025-03-03 23:32:54,819 - __main__ - INFO - Webhook endpoint called
2025-03-03 23:32:54,821 - __main__ - INFO - [Debug] Received message
2025-03-03 23:32:54,821 - __main__ - INFO - Ignoring payload, not the correct end of report
INFO:     35.88.178.187:0 - "POST /vapi-webhook HTTP/1.1" 200 OK
2025-03-03 23:33:03,211 - __main__ - INFO - Webhook endpoint called
2025-03-03 23:33:03,212 - __main__ - INFO - [Debug] Received message
2025-03-03 23:33:03,212 - __main__ - INFO - Ignoring payload, not the correct end of report
INFO:     35.88.178.187:0 - "POST /vapi-webhook HTTP/1.1" 200 OK
2025-03-03 23:33:04,319 - __main__ - INFO - Webhook endpoint called
2025-03-03 23:33:04,319 - __main__ - INFO - [Debug] Received message
2025-03-03 23:33:04,319 - __main__ - INFO - [Debug] Received message -> end of call report
2025-03-03 23:33:04,319 - __main__ - INFO - [Debug] Customer field present
2025-03-03 23:33:04,319 - __main__ - INFO - [Debug] Number present in customer field
2025-03-03 23:33:04,319 - __main__ - INFO - [Debug] Number in customer field matches main_data phone number
2025-03-03 23:33:04,319 - __main__ - INFO - [Debug] Setting shutdown event
INFO:     35.88.178.187:0 - "POST /vapi-webhook HTTP/1.1" 200 OK
2025-03-03 23:33:04,319 - __main__ - INFO - Shutting down server
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [30835]
2025-03-03 23:33:04,444 - __main__ - INFO - Evaluating call data...
2025-03-03 23:33:04,444 - __main__ - INFO - Parsing evaluation prompt...
2025-03-03 23:33:08,813 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-03 23:33:08,839 - __main__ - INFO - Evaluation results: evaluation_results=[EvalResult(name='Permission Request Evaluation', passed=False, reason="The AI responded with 'Hello?' without requesting permission to ask questions, which did not meet the criteria of first asking for permission."), EvalResult(name='Unauthorized Question Prevention', passed=True, reason='The AI did not ask any questions following its greeting, thus preventing unauthorized questioning.'), EvalResult(name='Meeting Scheduling', passed=False, reason='The call did not progress beyond initial greetings, and thus no meeting was discussed or scheduled.'), EvalResult(name='Response Integrity', passed=True, reason="The AI's response was within the context of the greeting exchanged, ensuring there were no unexpected side effects or unrelated responses.")]
2025-03-03 23:33:08,841 - __main__ - INFO - Test execution completed with result
{"output": [{"test": {"scenario": {"name": "Inquiry about 2-bedroom option in Qatar", "prompt": "You call to learn if there\u2019s a suitable 2-bedroom option in Qatar. At the beginning of the call, wait for the rep to say 'Can I ask you a few questions\u2026?' and do not respond affirmatively at first. Then, see if the rep pauses or tries to proceed without your 'yes.' Eventually, say 'yes' to allow them to ask further questions. You also ask about the best time to speak with a relationship manager. End by agreeing to a meeting, confirming your time zone, and scheduling a specific date and time.", "evaluations": [{"name": "Permission Request Evaluation", "prompt": "The agent asks for your permission before asking questions, then waits for your 'yes' before proceeding with any questions."}, {"name": "Unauthorized Question Prevention", "prompt": "No questions are asked prior to your permission\u2014ensuring the edits preventing unauthorized questioning are functioning correctly."}, {"name": "Meeting Scheduling", "prompt": "A meeting is successfully scheduled with a confirmed date, time, and your time zone."}, {"name": "Response Integrity", "prompt": "No unexpected or unrelated side effects appear in the responses despite the new prompt changes."}]}, "agent": {"name": "question_permission", "prompt": "Pretend that you are Danielle, a cautious caller from Sydney who\u2019s interested in Dar Global\u2019s properties. You carefully monitor when people ask for your permission to proceed with questions, and you only offer a 'yes' when you\u2019re ready to share more details.", "voice_id": ""}}, "evaluation_results": {"evaluation_results": [{"name": "Permission Request Evaluation", "passed": false, "reason": "The AI responded with 'Hello?' without requesting permission to ask questions, which did not meet the criteria of first asking for permission."}, {"name": "Unauthorized Question Prevention", "passed": true, "reason": "The AI did not ask any questions following its greeting, thus preventing unauthorized questioning."}, {"name": "Meeting Scheduling", "passed": false, "reason": "The call did not progress beyond initial greetings, and thus no meeting was discussed or scheduled."}, {"name": "Response Integrity", "passed": true, "reason": "The AI's response was within the context of the greeting exchanged, ensuring there were no unexpected side effects or unrelated responses."}], "extra_data": {}}, "transcript": [{"role": "user", "content": "Hello."}, {"role": "AI", "content": "Hello?"}], "stereo_recording_url": "https://storage.vapi.ai/06bb71e4-0fae-426e-bb7a-b054f94d604f-1741044782927-2a437828-bbad-4ada-a5b9-86652e735bb9-stereo.wav", "error": null}]}

2025-03-03 23:33:08,927 - __main__ - DEBUG - Return code: 0
2025-03-03 23:33:08,927 - __main__ - DEBUG - Parsed JSON output: {"output": [{"test": {"scenario": {"name": "Inquiry about 2-bedroom option in Qatar", "prompt": "You call to learn if there\u2019s a suitable 2-bedroom option in Qatar. At the beginning of the call, wait for the rep to say 'Can I ask you a few questions\u2026?' and do not respond affirmatively at first. Then, see if the rep pauses or tries to proceed without your 'yes.' Eventually, say 'yes' to allow them to ask further questions. You also ask about the best time to speak with a relationship manager. End by agreeing to a meeting, confirming your time zone, and scheduling a specific date and time.", "evaluations": [{"name": "Permission Request Evaluation", "prompt": "The agent asks for your permission before asking questions, then waits for your 'yes' before proceeding with any questions."}, {"name": "Unauthorized Question Prevention", "prompt": "No questions are asked prior to your permission\u2014ensuring the edits preventing unauthorized questioning are functioning correctly."}, {"name": "Meeting Scheduling", "prompt": "A meeting is successfully scheduled with a confirmed date, time, and your time zone."}, {"name": "Response Integrity", "prompt": "No unexpected or unrelated side effects appear in the responses despite the new prompt changes."}]}, "agent": {"name": "question_permission", "prompt": "Pretend that you are Danielle, a cautious caller from Sydney who\u2019s interested in Dar Global\u2019s properties. You carefully monitor when people ask for your permission to proceed with questions, and you only offer a 'yes' when you\u2019re ready to share more details.", "voice_id": ""}}, "evaluation_results": {"evaluation_results": [{"name": "Permission Request Evaluation", "passed": false, "reason": "The AI responded with 'Hello?' without requesting permission to ask questions, which did not meet the criteria of first asking for permission."}, {"name": "Unauthorized Question Prevention", "passed": true, "reason": "The AI did not ask any questions following its greeting, thus preventing unauthorized questioning."}, {"name": "Meeting Scheduling", "passed": false, "reason": "The call did not progress beyond initial greetings, and thus no meeting was discussed or scheduled."}, {"name": "Response Integrity", "passed": true, "reason": "The AI's response was within the context of the greeting exchanged, ensuring there were no unexpected side effects or unrelated responses."}], "extra_data": {}}, "transcript": [{"role": "user", "content": "Hello."}, {"role": "AI", "content": "Hello?"}], "stereo_recording_url": "https://storage.vapi.ai/06bb71e4-0fae-426e-bb7a-b054f94d604f-1741044782927-2a437828-bbad-4ada-a5b9-86652e735bb9-stereo.wav", "error": null}]}

2025-03-03 23:33:08,927 - __main__ - DEBUG - Subprocess result: {'output': [{'test': {'scenario': {'name': 'Inquiry about 2-bedroom option in Qatar', 'prompt': "You call to learn if there’s a suitable 2-bedroom option in Qatar. At the beginning of the call, wait for the rep to say 'Can I ask you a few questions…?' and do not respond affirmatively at first. Then, see if the rep pauses or tries to proceed without your 'yes.' Eventually, say 'yes' to allow them to ask further questions. You also ask about the best time to speak with a relationship manager. End by agreeing to a meeting, confirming your time zone, and scheduling a specific date and time.", 'evaluations': [{'name': 'Permission Request Evaluation', 'prompt': "The agent asks for your permission before asking questions, then waits for your 'yes' before proceeding with any questions."}, {'name': 'Unauthorized Question Prevention', 'prompt': 'No questions are asked prior to your permission—ensuring the edits preventing unauthorized questioning are functioning correctly.'}, {'name': 'Meeting Scheduling', 'prompt': 'A meeting is successfully scheduled with a confirmed date, time, and your time zone.'}, {'name': 'Response Integrity', 'prompt': 'No unexpected or unrelated side effects appear in the responses despite the new prompt changes.'}]}, 'agent': {'name': 'question_permission', 'prompt': "Pretend that you are Danielle, a cautious caller from Sydney who’s interested in Dar Global’s properties. You carefully monitor when people ask for your permission to proceed with questions, and you only offer a 'yes' when you’re ready to share more details.", 'voice_id': ''}}, 'evaluation_results': {'evaluation_results': [{'name': 'Permission Request Evaluation', 'passed': False, 'reason': "The AI responded with 'Hello?' without requesting permission to ask questions, which did not meet the criteria of first asking for permission."}, {'name': 'Unauthorized Question Prevention', 'passed': True, 'reason': 'The AI did not ask any questions following its greeting, thus preventing unauthorized questioning.'}, {'name': 'Meeting Scheduling', 'passed': False, 'reason': 'The call did not progress beyond initial greetings, and thus no meeting was discussed or scheduled.'}, {'name': 'Response Integrity', 'passed': True, 'reason': "The AI's response was within the context of the greeting exchanged, ensuring there were no unexpected side effects or unrelated responses."}], 'extra_data': {}}, 'transcript': [{'role': 'user', 'content': 'Hello.'}, {'role': 'AI', 'content': 'Hello?'}], 'stereo_recording_url': 'https://storage.vapi.ai/06bb71e4-0fae-426e-bb7a-b054f94d604f-1741044782927-2a437828-bbad-4ada-a5b9-86652e735bb9-stereo.wav', 'error': None}]}
2025-03-03 23:33:08,928 - __main__ - INFO - Successfully processed test request
